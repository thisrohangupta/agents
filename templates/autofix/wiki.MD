# Autofix Agent

**Version:** 1.0.0  
**Name:** Autofix

## Overview

The **Autofix Agent** is an intelligent remediation system designed to automatically diagnose, fix, and resolve failures in Continuous Integration (CI) pipelines. When a pipeline fails, the agent analyzes logs, code changes, and repository context to determine root causes, applies safe and scoped fixes, and raises pull requests (PRs) with clear explanations.

The goal is to **reduce developer toil**, **shorten CI feedback loops**, and **improve pipeline reliability**‚Äîwithout sacrificing safety or developer control.

---

## Key Capabilities

- üîç **Failure Diagnosis**

  - Parses CI logs to identify failure signatures
  - Correlates errors with recent code diffs
  - Understands language-, framework-, and tool-specific failure patterns

- üõ† **Automated Fix Generation**

  - Applies minimal, targeted fixes
  - Supports code changes, config updates, dependency fixes, and test adjustments
  - Respects repository conventions and style guidelines

- üîÅ **Pull Request Automation**

  - Creates PRs with human-readable explanations
  - Links fixes back to CI failures and root cause
  - Re-runs CI to validate fixes before marking ready

- üß† **Context-Aware Reasoning**
  - Uses PR diff context, historical failures, and repo metadata
  - Avoids speculative or high-risk changes
  - Learns from accepted and rejected fixes

---

## How It Works

1. **Clone Repository**: Clones from the specified branch (default: main)
2. **Remediation Agent**: Analyzes the failed execution logs and generates a fix task
3. **Coding Agent**: Executes the fix task to apply code changes (up to 50 iterations)
4. **Show Changes**: Displays git diff of applied fixes
5. **Detect SCM Provider**: Automatically identifies Git provider (Harness Code, GitHub, GitLab, etc.)
6. **Configure Authentication**: Sets up appropriate credentials based on SCM provider
7. **Push Changes**: Commits and pushes fixes to the `ai-autofix` branch
8. **Create PR**: Automatically creates a pull request back to the source branch

## Required Inputs

| Input | Type | Description | Default |
|-------|------|-------------|---------|
| `llmConnector` | connector | LLM connector for Claude AI (Anthropic) | _Required_ |
| `harnessKey` | secret | Harness API key for PR creation | `harness_api_key` |
| `gitConnector` | connector | Git connector for repository access | _Required_ |
| `repo` | string | Repository name to analyze | _Required_ |
| `branch` | string | Branch to clone from and create PR against | `main` |
| `executionId` | string | Harness execution ID of the failed pipeline | _Required_ |

## Configuration

- **Clone Depth:** 1 commit (shallow clone for performance)
- **Platform:** Linux (arm64)
- **Max Iterations:** 50 (for coding agent)
- **Detailed Logging:** Enabled
- **Branch Name:** `ai-autofix`
- **Force Push:** Enabled

## Agent Behavior

The autofix process works in two stages:

1. **Remediation Agent**: Analyzes the failed execution using the `executionId` to fetch logs and context, then generates a task file with fix instructions
2. **Coding Agent**: Reads the task file and applies the necessary code changes to fix the identified issues

## Usage Example

```yaml
inputs:
  repo: "my-organization/my-repository"
  branch: "main"
  executionId: "abc123xyz"
```

The agent will automatically handle the rest, including SCM provider detection, authentication, branch creation, and PR submission.

## Technical Details

### Remediation Agent Settings
- **Container Image**: `anewdocker25/mydockerhub:remediation-agent`
- **Output Directory**: `/harness/5c5b7e75_813d_40ec_9836_40b5bcf750e6_autofix`
- **Detailed Logging**: Enabled
- **Working Directory**: `/harness`

### Coding Agent Settings
- **Container Image**: `anewdocker25/mydockerhub:coding-agent`
- **Max Iterations**: 50
- **Task File**: Generated by remediation agent
- **Detailed Logging**: Enabled
- **Show Diff**: Disabled during execution (shown in separate step)

### Branch Management
- **Branch Name**: `ai-autofix`
- **Unique Per Execution**: No (reuses same branch name)
- **Force Push**: Enabled
- **Commit Message**: "Autofix: harness-auto-fix created this fix"

### Pull Request Configuration
- **Auto-Create**: Yes
- **PR Title**: "Autofix: AI automated fixes by Harness"
- **PR Description**: "Working on autofixing your CI checks. Please review the changes before merging."
- **Draft Mode**: Disabled
- **Bypass Rules**: Disabled (respects branch protection rules)

### SCM Provider Support

The agent automatically detects and configures authentication for:
- **Harness Code** (Git SCM type)
- **GitHub**
- **GitLab**
- **Bitbucket**
- Other Git providers

Authentication is handled transparently using the provided `gitConnector` and appropriate tokens.

## Best Practices

### Reviewing Generated Fixes
- Always review the PR before merging
- Verify fixes address the actual root cause
- Check that fixes don't introduce new issues
- Ensure fixes follow your team's conventions
- Validate that tests pass after applying fixes

### Repository Requirements
- Ensure the failed execution logs are accessible via the execution ID
- Have a clear project structure that the agent can analyze
- Include any necessary dependencies in your dependency files

## Troubleshooting

### Agent Doesn't Generate Fixes
- Verify the `llmConnector` is properly configured with valid Anthropic credentials
- Ensure the `executionId` is valid and accessible
- Check that the repository has accessible source code files
- Review agent logs in the pipeline execution

### Fixes Don't Resolve the Issue
- The agent may have misdiagnosed the root cause
- Review the remediation agent logs to understand its analysis
- Consider running the autofix again with updated context
- Manual intervention may be required for complex issues

### No PR Created
- Verify `harnessKey` secret has correct permissions
- Check that changes were actually made (review git diff step)
- Ensure branch permissions allow PR creation
- Confirm the `gitConnector` is properly configured

### Authentication Errors
- Verify the `gitConnector` has valid credentials
- For Harness Code: Ensure `harnessKey` is valid
- For external SCMs: Verify the connector token has push permissions
- Check that the SCM provider is correctly detected in logs

## Security Considerations

- API keys are stored as Harness secrets and never exposed in logs
- Agent only applies targeted fixes based on failure analysis
- All changes are submitted via PR for human review
- No automatic merging - requires developer approval
- Respects branch protection rules (bypass disabled by default)
- Authentication credentials are handled securely via netrc configuration

---

**Last Updated:** February 2026
